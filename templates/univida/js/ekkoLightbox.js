(function(){"use strict";var e,t;e=jQuery;t=function(t,n){var r,i,s,o=this;this.options=e.extend({title:null,footer:null,remote:null},e.fn.ekkoLightbox.defaults,n||{});this.$element=e(t);r="";this.modal_id=this.options.modal_id?this.options.modal_id:"ekkoLightbox-"+Math.floor(Math.random()*1e3+1);s='<div class="modal-header"'+(this.options.title||this.options.always_show_close?"":' style="display:none"')+'><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h4 class="modal-title">'+(this.options.title||"&nbsp;")+"</h4></div>";i='<div class="modal-footer"'+(this.options.footer?"":' style="display:none"')+">"+this.options.footer+"</div>";e(document.body).append('<div id="'+this.modal_id+'" class="ekko-lightbox modal fade" tabindex="-1"><div class="modal-dialog"><div class="modal-content">'+s+'<div class="modal-body"><div class="ekko-lightbox-container"><div></div></div></div>'+i+"</div></div></div>");this.modal=e("#"+this.modal_id);this.modal_dialog=this.modal.find(".modal-dialog").first();this.modal_content=this.modal.find(".modal-content").first();this.modal_body=this.modal.find(".modal-body").first();this.lightbox_container=this.modal_body.find(".ekko-lightbox-container").first();this.lightbox_body=this.lightbox_container.find("> div:first-child").first();this.modal_arrows=null;this.border={top:parseFloat(this.modal_dialog.css("border-top-width"))+parseFloat(this.modal_content.css("border-top-width"))+parseFloat(this.modal_body.css("border-top-width")),right:parseFloat(this.modal_dialog.css("border-right-width"))+parseFloat(this.modal_content.css("border-right-width"))+parseFloat(this.modal_body.css("border-right-width")),bottom:parseFloat(this.modal_dialog.css("border-bottom-width"))+parseFloat(this.modal_content.css("border-bottom-width"))+parseFloat(this.modal_body.css("border-bottom-width")),left:parseFloat(this.modal_dialog.css("border-left-width"))+parseFloat(this.modal_content.css("border-left-width"))+parseFloat(this.modal_body.css("border-left-width"))};this.padding={top:parseFloat(this.modal_dialog.css("padding-top"))+parseFloat(this.modal_content.css("padding-top"))+parseFloat(this.modal_body.css("padding-top")),right:parseFloat(this.modal_dialog.css("padding-right"))+parseFloat(this.modal_content.css("padding-right"))+parseFloat(this.modal_body.css("padding-right")),bottom:parseFloat(this.modal_dialog.css("padding-bottom"))+parseFloat(this.modal_content.css("padding-bottom"))+parseFloat(this.modal_body.css("padding-bottom")),left:parseFloat(this.modal_dialog.css("padding-left"))+parseFloat(this.modal_content.css("padding-left"))+parseFloat(this.modal_body.css("padding-left"))};this.modal.on("show.bs.modal",this.options.onShow.bind(this)).on("shown.bs.modal",function(){o.modal_shown();return o.options.onShown.call(o)}).on("hide.bs.modal",this.options.onHide.bind(this)).on("hidden.bs.modal",function(){if(o.gallery){e(document).off("keydown.ekkoLightbox")}o.modal.remove();return o.options.onHidden.call(o)}).modal("show",n);return this.modal};t.prototype={modal_shown:function(){var t,n=this;if(!this.options.remote){return this.error("No remote target given")}else{this.gallery=this.$element.data("gallery");if(this.gallery){if(this.options.gallery_parent_selector==="document.body"||this.options.gallery_parent_selector===""){this.gallery_items=e(document.body).find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]')}else{this.gallery_items=this.$element.parents(this.options.gallery_parent_selector).first().find('*[data-toggle="lightbox"][data-gallery="'+this.gallery+'"]')}this.gallery_index=this.gallery_items.index(this.$element);e(document).on("keydown.ekkoLightbox",this.navigate.bind(this));if(this.options.directional_arrows&&this.gallery_items.length>1){this.lightbox_container.prepend('<div class="ekko-lightbox-nav-overlay"><a href="#" class="'+this.strip_stops(this.options.left_arrow_class)+'"></a><a href="#" class="'+this.strip_stops(this.options.right_arrow_class)+'"></a></div>');this.modal_arrows=this.lightbox_container.find("div.ekko-lightbox-nav-overlay").first();this.lightbox_container.find("a"+this.strip_spaces(this.options.left_arrow_class)).on("click",function(e){e.preventDefault();return n.navigate_left()});this.lightbox_container.find("a"+this.strip_spaces(this.options.right_arrow_class)).on("click",function(e){e.preventDefault();return n.navigate_right()})}}if(this.options.type){if(this.options.type==="image"){return this.preloadImage(this.options.remote,true)}else if(this.options.type==="youtube"&&(t=this.getYoutubeId(this.options.remote))){return this.showYoutubeVideo(t)}else if(this.options.type==="vimeo"){return this.showVimeoVideo(this.options.remote)}else{return this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo"')}}else{return this.detectRemoteType(this.options.remote)}}},strip_stops:function(e){return e.replace(/\./g,"")},strip_spaces:function(e){return e.replace(/\s/g,"")},isImage:function(e){return e.match(/(^data:image\/.*,)|(\.(jp(e|g|eg)|gif|png|bmp|webp|svg)((\?|#).*)?$)/i)},isSwf:function(e){return e.match(/\.(swf)((\?|#).*)?$/i)},getYoutubeId:function(e){var t;t=e.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/);if(t&&t[2].length===11){return t[2]}else{return false}},getVimeoId:function(e){if(e.indexOf("vimeo")>0){return e}else{return false}},navigate:function(e){e=e||window.event;if(e.keyCode===39||e.keyCode===37){if(e.keyCode===39){return this.navigate_right()}else if(e.keyCode===37){return this.navigate_left()}}},navigate_left:function(){var t;if(this.gallery_items.length===1){return}if(this.gallery_index===0){this.gallery_index=this.gallery_items.length-1}else{this.gallery_index--}this.$element=e(this.gallery_items.get(this.gallery_index));this.updateTitleAndFooter();t=this.$element.attr("data-remote")||this.$element.attr("href");return this.detectRemoteType(t,this.$element.attr("data-type"))},navigate_right:function(){var t,n;if(this.gallery_items.length===1){return}if(this.gallery_index===this.gallery_items.length-1){this.gallery_index=0}else{this.gallery_index++}this.$element=e(this.gallery_items.get(this.gallery_index));n=this.$element.attr("data-remote")||this.$element.attr("href");this.updateTitleAndFooter();this.detectRemoteType(n,this.$element.attr("data-type"));if(this.gallery_index+1<this.gallery_items.length){t=e(this.gallery_items.get(this.gallery_index+1),false);n=t.attr("data-remote")||t.attr("href");if(t.attr("data-type")==="image"||this.isImage(n)){return this.preloadImage(n,false)}}},detectRemoteType:function(e,t){var n;if(t==="image"||this.isImage(e)){this.options.type="image";return this.preloadImage(e,true)}else if(t==="youtube"||(n=this.getYoutubeId(e))){this.options.type="youtube";return this.showYoutubeVideo(n)}else if(t==="vimeo"||(n=this.getVimeoId(e))){this.options.type="vimeo";return this.showVimeoVideo(n)}else{return this.error('Could not detect remote target type. Force the type using data-type="image|youtube|vimeo"')}},updateTitleAndFooter:function(){var e,t,n,r;n=this.modal_content.find(".modal-header");t=this.modal_content.find(".modal-footer");r=this.$element.data("title")||"&nbsp;";e=this.$element.data("footer")||"";n.css("display","").find(".modal-title").html(r);if(r||this.options.always_show_close){n.css("display","")}else{n.css("display","none")}if(e){t.css("display","").html(e)}else{t.css("display","none")}return this},showLoading:function(){this.lightbox_body.html('<div class="modal-loading">Loading..</div>');return this},showYoutubeVideo:function(e){var t,n,r;t=560/315;r=this.$element.data("width")||560;r=this.checkDimensions(r);n=r/t;this.resize(r);this.lightbox_body.html('<iframe width="'+r+'" height="'+n+'" src="//www.youtube.com/embed/'+e+'?badge=0&autoplay=1&html5=1" frameborder="0" allowfullscreen></iframe>');if(this.modal_arrows){return this.modal_arrows.css("display","none")}},showVimeoVideo:function(e){var t,n,r;t=500/281;r=this.$element.data("width")||560;r=this.checkDimensions(r);n=r/t;this.resize(r);this.lightbox_body.html('<iframe width="'+r+'" height="'+n+'" src="'+e+'?autoplay=1" frameborder="0" allowfullscreen></iframe>');if(this.modal_arrows){return this.modal_arrows.css("display","none")}},error:function(e){this.lightbox_body.html(e);return this},preloadImage:function(t,n){var r,i=this;r=new Image;if(n==null||n===true){r.onload=function(){var t;t=e("<img />");t.attr("src",r.src);t.addClass("img-responsive");i.lightbox_body.html(t);if(i.modal_arrows){i.modal_arrows.css("display","block")}return i.resize(r.width)};r.onerror=function(){return i.error("Failed to load image: "+t)}}r.src=t;return r},resize:function(t){var n;n=t+this.border.left+this.padding.left+this.padding.right+this.border.right;this.modal_dialog.css("width","auto").css("max-width",n);this.lightbox_container.find("a").css("padding-top",function(){return e(this).parent().height()/2});return this},checkDimensions:function(e){var t,n;n=e+this.border.left+this.padding.left+this.padding.right+this.border.right;t=document.body.clientWidth;if(n>t){e=this.modal_body.width()}return e},close:function(){return this.modal.modal("hide")}};e.fn.ekkoLightbox=function(n){return this.each(function(){var r;r=e(this);n=e.extend({remote:r.attr("data-remote")||r.attr("href"),gallery_parent_selector:r.attr("data-parent"),type:r.attr("data-type")},n,r.data());new t(this,n);return this})};e.fn.ekkoLightbox.defaults={gallery_parent_selector:"*:not(.row)",left_arrow_class:".glyphicon .glyphicon-chevron-left",right_arrow_class:".glyphicon .glyphicon-chevron-right",directional_arrows:true,type:null,always_show_close:true,onShow:function(){},onShown:function(){},onHide:function(){},onHidden:function(){}}}).call(this)